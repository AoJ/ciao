#!/usr/bin/env node

var coffee = require( 'coffee-script' );
var CiaoScript = require( '../lib/CiaoScript' );
var TestRunner = require( '../lib/TestRunner' );
var Reporter = require( '../lib/Reporter' );
var Request = require( '../lib/Request' );
var Settings = require( '../lib/Settings' );
var TestSuite = require( '../lib/TestSuite' );
var program = require('commander');

program
  .version('0.0.1')
  .usage('[options] <file ...>')
  .option('-d, --documentation', 'generate documentation')
  .parse(process.argv);

settings = new Settings();

var suite = new TestSuite( settings, function( filename, suite ){
  var script = new CiaoScript( filename, suite.settings );
  var runner = new TestRunner( script.parser.sections.assert );
  runner.listener( Reporter );
  var request = new Request();
  request.listener( runner.complete );
  request.transfer( script.request );
});

// Run single script(s)
suite.walk( program.args[0] );